(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))y(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&y(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function y(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const I=document.getElementById("stage"),c=I.getContext("2d"),u=1920,f=1080,T=900,F="/valentine/";function d(e){const o=e.startsWith("/")?e.slice(1):e;return F+o}const j={bg:d("background.jpg"),shop:d("shop.jpg"),girl_stand:d("girl_stand.png"),girl_surprise:d("girl_surprise.png"),boy_walk1:d("boy_walk1.jpg"),boy_walk2:d("boy_walk2.jpg"),boy_kneel:d("boy_kneel.png"),hug:d("hug.jpg")},X=["#e53935","#d81b60","#8e24aa","#5e35b1","#3949ab","#1e88e5","#00acc1","#00897b","#43a047","#7cb342","#f4511e"],Y=["In a world of black and white...","You paint my life with color.","Every moment with you is magic.","Your smile is my favorite sunlight.","I promise to always hold your hand.","To buy you flowers just because.","To listen to your stories.","To be your biggest fan.","You are my best friend.","My safe place.","I love you, Arushi. ❤️"],s={},p=new Audio(d("music.mp3"));p.loop=!0;p.volume=.5;let k=0;const A=Object.keys(j).length;let _=!1;const t={time:0,scene:"intro",camera:{x:0,y:0},boy:{x:2200,y:T,speed:4,bobOffset:0},girl:{x:600,y:T}};function U(){H(),window.addEventListener("resize",H),G(),p.play().catch(()=>{const e=()=>{p.play(),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};document.addEventListener("click",e),document.addEventListener("keydown",e)}),setTimeout(()=>{_||(console.warn("Forcing Start..."),document.getElementById("loading").classList.add("hidden"),P())},3e3);for(const[e,o]of Object.entries(j)){const i=new Image;i.src=o,i.onload=()=>{_||(k++,k===A&&(document.getElementById("loading").classList.add("hidden"),P()))},i.onerror=()=>{console.error(`ERROR LOADING: ${o}`),k++,k===A&&(document.getElementById("loading").classList.add("hidden"),P())},s[e]=i}}function G(){const e=document.getElementById("btn-no"),o=document.getElementById("btn-yes"),i=document.getElementById("proposal-ui"),y=document.getElementById("celebration-ui"),n=document.querySelector(".quote");let r=!1;document.addEventListener("mousemove",l=>{if(i.classList.contains("hidden"))return;const a=e.getBoundingClientRect(),x=a.left+a.width/2,w=a.top+a.height/2,E=l.clientX,L=l.clientY,v=Math.hypot(E-x,L-w),O=300;if(v<O){if(!r){r=!0,e.style.position="fixed",e.style.left=`${a.left}px`,e.style.top=`${a.top}px`;return}const N=x-E,R=w-L;let $=N/v,q=R/v;const C=(O-v)/O,S=150,z=$*C*S,D=q*C*S;let m=a.left+z,b=a.top+D;const g=50,M=window.innerWidth-a.width-g,W=window.innerHeight-a.height-g;m<g&&(m=g+10),m>M&&(m=M-10),b<g&&(b=g+10),b>W&&(b=W-10),v<50&&(m<=g+20||m>=M-20)&&(m=window.innerWidth/2,b=window.innerHeight/2),e.style.left=`${m}px`,e.style.top=`${b}px`}}),o.addEventListener("click",()=>{t.scene="celebration",i.classList.add("hidden"),y.classList.remove("hidden"),p.paused&&p.play(),K(),V(n)})}function V(e){let o=0;function i(){o>=Y.length||(e.classList.remove("visible"),setTimeout(()=>{e.textContent=Y[o],e.style.color=X[o%X.length],e.classList.add("visible"),o++,setTimeout(i,3500)},1e3))}e.textContent="",i()}const B=[];function K(){for(let e=0;e<100;e++)B.push({x:Math.random()*u,y:f+Math.random()*200,vx:(Math.random()-.5)*4,vy:-3-Math.random()*5,size:10+Math.random()*30,color:`hsl(${320+Math.random()*60}, 90%, 70%)`,rotation:Math.random()*Math.PI,spin:(Math.random()-.5)*.1})}function J(){B.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.rotation+=e.spin,e.y<-100&&(e.y=f+100,e.x=Math.random()*u)})}function Q(){B.forEach(e=>{c.save(),c.translate(e.x-t.camera.x,e.y-t.camera.y),c.rotate(e.rotation),c.fillStyle=e.color,c.beginPath();const o=e.size;c.moveTo(0,0),c.bezierCurveTo(-o/2,-o/2,-o,o/3,0,o),c.bezierCurveTo(o,o/3,o/2,-o/2,0,0),c.fill(),c.restore()})}function H(){const e=Math.min(window.innerWidth/u,window.innerHeight/f);I.width=u,I.height=f,I.style.width=`${u*e}px`,I.style.height=`${f*e}px`}function h(e,o,i,y={}){if(!e||e.naturalWidth===0&&e.complete)return;const n=y.scale||1,r=y.anchorBottom??!0,l=e.width,a=e.height,x=l*n,w=a*n,E=o-t.camera.x-x/2,L=i-t.camera.y-(r?w:0);c.globalCompositeOperation="multiply",c.drawImage(e,0,0,l,a,E,L,x,w),c.globalCompositeOperation="source-over"}function Z(){if(t.time++,t.scene==="celebration"){J();const o=(t.boy.x+t.girl.x)/2-u/2;t.camera.x+=(o-t.camera.x)*.05;return}if(t.scene==="intro")t.time>60&&(t.scene="enter");else if(t.scene==="enter"){t.boy.x-=t.boy.speed,t.boy.bobOffset=Math.sin(t.time*.4)*5;const e=t.boy.x-u*.7;t.camera.x+=(Math.max(0,e)-t.camera.x)*.05,t.boy.x-t.girl.x<300&&(t.scene="kneel",t.boy.bobOffset=0)}else if(t.scene==="kneel"){const e=(t.boy.x+t.girl.x)/2-u/2;t.camera.x+=(e-t.camera.x)*.02,t.kneelTime||(t.kneelTime=t.time),t.time-t.kneelTime>60&&(t.scene="reaction",setTimeout(()=>{document.getElementById("proposal-ui").classList.remove("hidden")},1e3))}}function ee(){if(c.fillStyle="#fcf8e3",c.fillRect(0,0,u,f),s.bg){const e=-t.camera.x*.2,o=f/s.bg.height;c.drawImage(s.bg,e,0,s.bg.width*o,f)}if(h(s.shop,300,T,{scale:.8}),t.scene==="celebration")if(s.hug&&s.hug.complete&&s.hug.naturalWidth>0){const o=(t.boy.x+t.girl.x)/2;h(s.hug,o,T,{scale:.8})}else h(s.girl_surprise,t.girl.x,t.girl.y,{scale:.65}),h(s.boy_kneel,t.boy.x,t.boy.y,{scale:.65});else{const e=t.scene==="reaction"?s.girl_surprise:s.girl_stand;if(h(e,t.girl.x,t.girl.y,{scale:.65}),t.scene==="kneel"||t.scene==="reaction")h(s.boy_kneel,t.boy.x,t.boy.y,{scale:.65});else{const i=Math.floor(t.time/8)%2===0?s.boy_walk1:s.boy_walk2;h(i,t.boy.x,t.boy.y+t.boy.bobOffset,{scale:.65})}}t.scene==="celebration"&&Q()}function P(){if(_)return;_=!0;function e(){Z(),ee(),requestAnimationFrame(e)}e()}U();
