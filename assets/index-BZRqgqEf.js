(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&f(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function f(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const v=document.getElementById("stage"),c=v.getContext("2d"),d=1920,m=1080,k=900,H={bg:"/background.jpg",shop:"/shop.jpg",girl_stand:"/girl_stand.png",girl_surprise:"/girl_surprise.png",boy_walk1:"/boy_walk1.jpg",boy_walk2:"/boy_walk2.jpg",boy_kneel:"/boy_kneel.png",hug:"/hug.jpg"},W=["#e53935","#d81b60","#8e24aa","#5e35b1","#3949ab","#1e88e5","#00acc1","#00897b","#43a047","#7cb342","#f4511e"],X=["In a world of black and white...","You paint my life with color.","Every moment with you is magic.","Your smile is my favorite sunlight.","I promise to always hold your hand.","To buy you flowers just because.","To listen to your stories.","To be your biggest fan.","You are my best friend.","My safe place.","I love you, Arushi. ❤️"],s={},b=new Audio("/music.mp3");b.loop=!0;b.volume=.5;let L=0;const Y=Object.keys(H).length;let T=!1;const t={time:0,scene:"intro",camera:{x:0,y:0},boy:{x:2200,y:k,speed:4,bobOffset:0},girl:{x:600,y:k}};function D(){A(),window.addEventListener("resize",A),F(),b.play().catch(()=>{console.log("Autoplay blocked. Waiting for interact.");const e=()=>{b.play(),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};document.addEventListener("click",e),document.addEventListener("keydown",e)}),setTimeout(()=>{T||(console.warn("Forcing Start..."),document.getElementById("loading").classList.add("hidden"),M())},3e3);for(const[e,o]of Object.entries(H)){const i=new Image;i.src=o,i.onload=()=>{T||(L++,L===Y&&(document.getElementById("loading").classList.add("hidden"),M()))},i.onerror=()=>{console.error(`ERROR LOADING: ${o}`),L++,L===Y&&(document.getElementById("loading").classList.add("hidden"),M())},s[e]=i}}function F(){const e=document.getElementById("btn-no"),o=document.getElementById("btn-yes"),i=document.getElementById("proposal-ui"),f=document.getElementById("celebration-ui"),n=document.querySelector(".quote");let r=!1;document.addEventListener("mousemove",l=>{if(i.classList.contains("hidden"))return;const a=e.getBoundingClientRect(),p=a.left+a.width/2,x=a.top+a.height/2,I=l.clientX,E=l.clientY,w=Math.hypot(I-p,E-x),_=300;if(w<_){if(!r){r=!0,e.style.position="fixed",e.style.left=`${a.left}px`,e.style.top=`${a.top}px`;return}const j=p-I,R=x-E;let $=j/w,N=R/w;const P=(_-w)/_,B=150,q=$*P*B,z=N*P*B;let u=a.left+q,h=a.top+z;const y=50,O=window.innerWidth-a.width-y,S=window.innerHeight-a.height-y;u<y&&(u=y+10),u>O&&(u=O-10),h<y&&(h=y+10),h>S&&(h=S-10),w<50&&(u<=y+20||u>=O-20)&&(u=window.innerWidth/2,h=window.innerHeight/2),e.style.left=`${u}px`,e.style.top=`${h}px`}}),o.addEventListener("click",()=>{t.scene="celebration",i.classList.add("hidden"),f.classList.remove("hidden"),b.paused&&b.play(),G(),U(n)})}function U(e){let o=0;function i(){o>=X.length||(e.classList.remove("visible"),setTimeout(()=>{e.textContent=X[o],e.style.color=W[o%W.length],e.classList.add("visible"),o++,setTimeout(i,3500)},1e3))}e.textContent="",i()}const C=[];function G(){for(let e=0;e<100;e++)C.push({x:Math.random()*d,y:m+Math.random()*200,vx:(Math.random()-.5)*4,vy:-3-Math.random()*5,size:10+Math.random()*30,color:`hsl(${320+Math.random()*60}, 90%, 70%)`,rotation:Math.random()*Math.PI,spin:(Math.random()-.5)*.1})}function V(){C.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.rotation+=e.spin,e.y<-100&&(e.y=m+100,e.x=Math.random()*d)})}function K(){C.forEach(e=>{c.save(),c.translate(e.x-t.camera.x,e.y-t.camera.y),c.rotate(e.rotation),c.fillStyle=e.color,c.beginPath();const o=e.size;c.moveTo(0,0),c.bezierCurveTo(-o/2,-o/2,-o,o/3,0,o),c.bezierCurveTo(o,o/3,o/2,-o/2,0,0),c.fill(),c.restore()})}function A(){const e=Math.min(window.innerWidth/d,window.innerHeight/m);v.width=d,v.height=m,v.style.width=`${d*e}px`,v.style.height=`${m*e}px`}function g(e,o,i,f={}){if(!e||e.naturalWidth===0&&e.complete)return;const n=f.scale||1,r=f.anchorBottom??!0,l=e.width,a=e.height,p=l*n,x=a*n,I=o-t.camera.x-p/2,E=i-t.camera.y-(r?x:0);c.globalCompositeOperation="multiply",c.drawImage(e,0,0,l,a,I,E,p,x),c.globalCompositeOperation="source-over"}function J(){if(t.time++,t.scene==="celebration"){V();const o=(t.boy.x+t.girl.x)/2-d/2;t.camera.x+=(o-t.camera.x)*.05;return}if(t.scene==="intro")t.time>60&&(t.scene="enter");else if(t.scene==="enter"){t.boy.x-=t.boy.speed,t.boy.bobOffset=Math.sin(t.time*.4)*5;const e=t.boy.x-d*.7;t.camera.x+=(Math.max(0,e)-t.camera.x)*.05,t.boy.x-t.girl.x<300&&(t.scene="kneel",t.boy.bobOffset=0)}else if(t.scene==="kneel"){const e=(t.boy.x+t.girl.x)/2-d/2;t.camera.x+=(e-t.camera.x)*.02,t.kneelTime||(t.kneelTime=t.time),t.time-t.kneelTime>60&&(t.scene="reaction",setTimeout(()=>{document.getElementById("proposal-ui").classList.remove("hidden")},1e3))}}function Q(){if(c.fillStyle="#fcf8e3",c.fillRect(0,0,d,m),s.bg){const e=-t.camera.x*.2,o=m/s.bg.height;c.drawImage(s.bg,e,0,s.bg.width*o,m)}if(g(s.shop,300,k,{scale:.8}),t.scene==="celebration")if(s.hug&&s.hug.complete&&s.hug.naturalWidth>0){const o=(t.boy.x+t.girl.x)/2;g(s.hug,o,k,{scale:.8})}else g(s.girl_surprise,t.girl.x,t.girl.y,{scale:.65}),g(s.boy_kneel,t.boy.x,t.boy.y,{scale:.65});else{const e=t.scene==="reaction"?s.girl_surprise:s.girl_stand;if(g(e,t.girl.x,t.girl.y,{scale:.65}),t.scene==="kneel"||t.scene==="reaction")g(s.boy_kneel,t.boy.x,t.boy.y,{scale:.65});else{const i=Math.floor(t.time/8)%2===0?s.boy_walk1:s.boy_walk2;g(i,t.boy.x,t.boy.y+t.boy.bobOffset,{scale:.65})}}t.scene==="celebration"&&K()}function M(){if(T)return;T=!0;function e(){J(),Q(),requestAnimationFrame(e)}e()}D();
